
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>سیستم یادآوری تولد</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/jalaali-js@1.1.0/dist/jalaali.min.js"></script>
  <script type="module">
    // پیکربندی Firebase (اطلاعات واقعی خودت رو جایگزین کن)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.saveCongratulations = async function(customerId) {
      const today = new Date();
      const j = jalaali.toJalaali(today);
      const todayKey = `${j.jy}-${j.jm}-${j.jd}`;
      await set(ref(db, 'congratulated/' + todayKey + '/' + customerId), true);
    }

    window.checkCongratulations = async function(customerId, callback) {
      const today = new Date();
      const j = jalaali.toJalaali(today);
      const todayKey = `${j.jy}-${j.jm}-${j.jd}`;
      const snapshot = await get(ref(db, 'congratulated/' + todayKey + '/' + customerId));
      callback(snapshot.exists());
    }

    window.getTodayJalali = function() {
      const today = new Date();
      const j = jalaali.toJalaali(today);
      return {
        str: `${j.jy}/${String(j.jm).padStart(2, '0')}/${String(j.jd).padStart(2, '0')}`,
        day: j.jd,
        month: j.jm,
        year: j.jy
      };
    }
  </script>
  <style>
    body { font-family: sans-serif; }
    .birthday-today {
      background: #fee2e2;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #futureToggleBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #1e3a8a;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      line-height: 40px;
      text-align: center;
      cursor: pointer;
      z-index: 100;
    }
    #futureBirthdaysPanel {
      display: none;
      position: fixed;
      top: 80px;
      left: 20px;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 99;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="p-4 bg-gray-50">
  <h1 class="text-2xl font-bold mb-6 text-indigo-700">🎂 تولدهای امروز</h1>

  <!-- لیست تولدهای امروز -->
  <div id="todayBirthdays"></div>

  <!-- آیکون عدد 7 برای نمایش تولدهای آینده -->
  <div id="futureToggleBtn">7</div>

  <!-- پنل تولدهای ۷ روز آینده -->
  <div id="futureBirthdaysPanel">
    <h2 class="font-bold mb-2">🎁 تولدهای ۷ روز آینده</h2>
    <div id="futureBirthdays"></div>
  </div>

  <script type="module">
    // فرض: لیست مشتریان (می‌تونه از Firebase یا JSON هم بیاد)
    const customers = [
      { id: 1, name: 'علی رضایی', birth: '1403/03/10' },
      { id: 2, name: 'زهرا کریمی', birth: '1403/03/12' },
      { id: 3, name: 'مهدی حسینی', birth: '1403/03/17' },
      { id: 4, name: 'فاطمه زارع', birth: '1403/03/10' }
    ];

    const today = getTodayJalali();
    const todayStr = today.str;
    const todayContainer = document.getElementById('todayBirthdays');
    const futureContainer = document.getElementById('futureBirthdays');

    customers.forEach(customer => {
      const [y, m, d] = customer.birth.split('/').map(x => parseInt(x));
      const isToday = (y === today.year && m === today.month && d === today.day);
      const dayDiff = d - today.day;

      if (m === today.month && dayDiff > 0 && dayDiff <= 7) {
        // تولد در ۷ روز آینده
        const div = document.createElement('div');
        div.className = 'birthday-soon border-b border-gray-200 py-2';
        div.textContent = `${customer.name} - ${customer.birth}`;
        futureContainer.appendChild(div);
      }

      if (isToday) {
        // تولد امروز
        const div = document.createElement('div');
        div.className = 'birthday-today';
        const info = document.createElement('span');
        info.innerHTML = `<strong>${customer.name}</strong> - ${customer.birth}`;
        const btn = document.createElement('button');
        btn.className = 'bg-green-600 text-white px-3 py-1 rounded text-sm';
        btn.textContent = '🎉 تبریک بگو';
        btn.disabled = true;

        checkCongratulations(customer.id, (already) => {
          if (already) {
            btn.textContent = '✅ تبریک گفته شد';
            btn.disabled = true;
          } else {
            btn.disabled = false;
            btn.addEventListener('click', async () => {
              await saveCongratulations(customer.id);
              btn.textContent = '✅ تبریک گفته شد';
              btn.disabled = true;
            });
          }
        });

        div.appendChild(info);
        div.appendChild(btn);
        todayContainer.appendChild(div);
      }
    });

    // کنترل نمایش و پنهان کردن پنل تولدهای آینده
    document.getElementById('futureToggleBtn').addEventListener('click', () => {
      const panel = document.getElementById('futureBirthdaysPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    });
  </script>
</body>
</html>
    customers.forEach(customer => {
      const [y, m, d] = customer.birth.split('/').map(x => parseInt(x));
      const isToday = (m === today.month && d === today.day);
      const dayDiff = d - today.day;

      if (m === today.month && dayDiff > 0 && dayDiff <= 7) {
        // تولد در ۷ روز آینده
        const div = document.createElement('div');
        div.className = 'birthday-soon border-b border-gray-200 py-2';
        div.textContent = `${customer.name} - ${customer.birth}`;
        futureContainer.appendChild(div);
      }

      if (isToday) {
        // تولد امروز
        const div = document.createElement('div');
        div.className = 'birthday-today';
        const info = document.createElement('span');
        info.innerHTML = `<strong>${customer.name}</strong> - ${customer.birth}`;
        const btn = document.createElement('button');
        btn.className = 'bg-green-600 text-white px-3 py-1 rounded text-sm';
        btn.textContent = '🎉 تبریک بگو';
        btn.disabled = true;

        // چک کردن تبریک از Firebase
        checkCongratulations(customer.id, (already) => {
          if (already) {
            btn.textContent = '✅ تبریک گفته شد';
            btn.disabled = true;
          } else {
            btn.disabled = false;
            btn.addEventListener('click', async () => {
              await saveCongratulations(customer.id);
              btn.textContent = '✅ تبریک گفته شد';
              btn.disabled = true;
            });
          }
        });

        div.appendChild(info);
        div.appendChild(btn);
        todayContainer.appendChild(div);
      }
    });
    // کنترل نمایش و پنهان کردن لیست تولدهای آینده
    document.getElementById('futureToggleBtn').addEventListener('click', () => {
      const panel = document.getElementById('futureBirthdaysPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    });
  </script>
</body>
</html>
